<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
  <!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">
    <link type="text/css" href="/css/images/icons/fontawesome2/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/test.css">
    <link rel="stylesheet" href="/css/style.css">
    
    <link rel="stylesheet" href="/css/test2.css">
    <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer"> -->
  <script src="/js/product.js"></script>
    <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css" integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A==" crossorigin="anonymous" referrerpolicy="no-referrer" /> -->
</head>
<body>
    <!-- header -->
    <header>
        <!-- navbar -->
        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
              <a class="navbar-brand" th:href="@{/}">
                <img class="navbar__logo" src="/assets/logo.jpg" alt="">
                <span>Roku Coffee</span></a>
              <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
              </button>
              <div class="collapse navbar-collapse justify-content-end" id="navbarNav">
                <ul class="navbar-nav">
                  <li class="nav-item">
                    <a class="nav-link" aria-current="page" th:href="@{/}">Trang Chủ</a>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" >Loại</a>
                    <div class="nav-item__cate row">
                      <!-- danh sách cafe -->
                      <ul class="nav-item__cate-list col-md-4">
                        <div class="d-flex align-items-center"> 
                          <i class="fa-solid fa-caret-right"></i>
                          <a th:href="@{/product/ca-phe-hat}" class="m-0">Cà phê hạt</a></div>
                      </ul>
                      <ul class="nav-item__cate-list col-md-4">
                        <div class="d-flex align-items-center"> 
                          <i class="fa-solid fa-caret-right"></i>
                          <a th:href="@{/product/ca-phe-phin}" class="m-0">Cà phê phin</a></div>
            
                      </ul>
                      <ul class="nav-item__cate-list col-md-4">
                        <div class="d-flex align-items-center"> 
                          <i class="fa-solid fa-caret-right"></i>
                          <a th:href="@{/product/ca-phe-hoa-tan}" class="m-0">Cà phê hòa tan</a></div>
               
                      </ul>
                
                    </div>
                  </li>
                  <li class="nav-item">
                    <a class="nav-link" th:href="@{/product/views}">Sản Phẩm</a>
                  </li>
            
                </ul>
                <div class=" navbar__search d-flex">
                    <input class="navbar__search--form form-control"type="text" placeholder="Tìm kiếm" aria-label="default input example">
                    <i class="navbar__search--icon fa-solid fa-magnifying-glass" style="color: white;"></i>
                </div>
                <ul class="navbar__search-list">
                      
                </ul>
                <div class="navbar__cart">
                  <a class="navbar__cart--link" th:href="@{/shopping-cart/views}">  <i class="navbar__cart--icon fa-solid fa-cart-shopping"></i>
                    <span th:text="${totalCartItems}" class="navbar__quantities">
                      
                    </span></a>
                  </div>
                <div class="navbar__user-dropdown">
                  <a class="navbar__user-link"><i class="fa-regular fa-user"></i></a>
                  <ul class="navbar__user-dropdown_list">
                    
                    <li th:if="${userName}">Chào Mừng <span th:text="${userName}"></span></li>
                    <li th:if="${userName}!='GUEST'"><a th:href="@{/account/view/5}">Tài Khoản</a></li>
                    <li th:if="${userName}!='GUEST'"><a th:href="@{/history/views}">Đơn Hàng</a></li>
                      <li th:if="${userName}=='GUEST'"><a th:href="@{/account/login}">Đăng Nhập</a></li>
                      <li th:if="${userName}!='GUEST'"><a th:href="@{/account/logout}">Đăng Xuất</a></li>
                    
  
                  </ul>
                  </div>
              </div>
            </div>
          </nav>
           <!-- navbar -->
    <!-- navbar sub -->

    <div class="navbar__sub">
        <div class="container-fluid">
            <div class="navbar__sub--intro">
                <h1 class="nav__sub--item">Trang Chủ</h1>
                <i class="fa-sharp fa-solid fa-arrow-right" style="font-size: 20px;"></i>
                <h1 class="nav__sub--item">Sản Phẩm</h1>
            </div>
        </div>
    </div>

    <!-- navbar sub -->
    </header>
     <!-- header -->

     <!-- body -->
    <body>
        <section class="container section-1 text-center ">
        <div class=" row"> 
            <div class="col-md-2 cate-list__product">
              <ul class="nav-item__cate-list col-md-4" style="width: 100%;">
                <div class="d-flex align-items-center"> 
                  <i class="fa-solid fa-caret-right"></i>
                  <a th:href="@{/product/ca-phe-hat}" class="m-0">Cà phê hạt</a></div>
              </ul>
              <ul class="nav-item__cate-list col-md-4" style="width: 100%;">
                <div class="d-flex align-items-center"> 
                  <i class="fa-solid fa-caret-right"></i>
                  <a th:href="@{/product/ca-phe-phin}" class="m-0">Cà phê phin</a></div>
    
              </ul>
              <ul class="nav-item__cate-list col-md-4" style="width: 100%;">
                <div class="d-flex align-items-center"> 
                  <i class="fa-solid fa-caret-right"></i>
                  <a th:href="@{/product/ca-phe-hoa-tan}" class="m-0">Cà phê hòa tan</a></div>
       
              </ul>
            </div>
            <div class=" row col-md-10 row__product">
                <div class="row__product-container ">
                  <div class="row__product-container_sort">
                    <p>Sắp xếp theo</p>
                    <button class="">Mới Nhất</button>
                    <button class="btn_sale">Bán Chạy</button>
                    <div class="dropdown dropdown_price">
                      <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenu2" data-bs-toggle="dropdown" aria-expanded="false">
                        Giá
                      </button>
                      <ul class="dropdown-menu" aria-labelledby="dropdownMenu2">
                        <li><button class="dropdown-item item__price btn_high" type="button">Thấp Đến Cao</button></li>
                        <li><button class="dropdown-item item__price btn_low" type="button">Cao Đến Thấp</button></li>
                      </ul>
                    </div>
                  </div>
                  <th:block th:if="${#lists.size(productList)!=0}">
                  <div class="row__product-container-route">
                    <span class="row__product-numpage">
                       <span style="color: #FA7A31;"><b>[[${currentPage}]]</b></span><b>/[[${totalPages}]]</b>
                    </span>
                    
                    <button ><a th:href="@{'?pageNo='+${((currentPage==1)||(currentPage=='1'))?currentPage:(currentPage-1)}}"><i class="fa-sharp fa-solid fa-caret-left"></i></a></button>
                    <button><a th:href="@{'?pageNo='+${#strings.equals(currentPage, totalPages)?totalPages:(currentPage-(-1))}}"><i class="fa-sharp fa-solid fa-caret-right"></i></a></button>
         
                  </div>
                </th:block>
                </div>
                <th:block th:if="${#lists.size(productList)==0}">
                    <span style="font-size: 14px;color: red ;">Không tìm thấy sản phẩm cho từ khóa "[[${searchKey}]]"</span>
                  </th:block>
                  <div class="row row__products">
                    <div th:each="product,iter:${productList}" class="col-md-3 col-sm-6">
                      <div class="card" style="width: 100%;" th:onclick="return handleClick([[${product.id}]])
                      ">
                        <img style="object-fit: scale-down;"height="200" th:src="'data:image/jpeg;base64,' + ${product.strImage}" class="card-img-top" alt="...">
                        <div class="card-body">
                          <h1 class="card-title" th:text=${product.title}></h1>
                          <p class="card-sub">Đậm đà vị cafe</p>
                          <div class="card__price d-flex">
                            <p class="price" th:text=${product.price}></p>
                            <div class="card_status d-flex">
                              <p class="card_status_des">đã bán</p>
                              <p class="quantities" th:text=${product.saled}></p> 
                            </div>
                          </div>
                          
                        </div>
                      </div>
                    </div>
                  </div>
               
            
                  
                </div>
              </div>
        </section>
    </body>
      <!-- body -->

      <!-- footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="footer__element col-md-3">
                    <p>THANH TOÁN</p>
                    <div class="row">
                      <img class="footer__pay--icon col-md-4" src="/assets/visa.png" alt="">
                      <img class="footer__pay--icon col-md-4" src="/assets/mastercard.png" alt="">
                      <img class="footer__pay--icon col-md-4" src="/assets/jcb.png" alt="">
                      <img class="footer__pay--icon col-md-4" src="/assets/ame.png" alt="">
                      <img class="footer__pay--icon col-md-4" src="/assets/sp.png" alt="">
                    </div>
                </div>
                <div class="footer__element col-md-3">
                  <p>ĐƠN VỊ VẬN CHUYỂN</p>
                  <div class="row">
                    <img class="footer__deli--icon col-md-4" src="/assets/dvvc1.png" alt="">
                    <img class="footer__deli--icon col-md-4" src="/assets/jcb.png" alt="">
                    <img class="footer__deli--icon col-md-4" src="/assets/njVan.png" alt="">
                    <img class="footer__deli--icon col-md-4" src="/assets/best.png" alt="">
                    <img class="footer__deli--icon col-md-4" src="/assets/vt.png" alt="">
                    <img class="footer__deli--icon col-md-4" src="/assets/vnsp.png" alt="">
                  </div>
              </div>
                <div class="footer__element col-md-3">
                    <p>LIÊN HỆ</p>
                    <div class="footer__contact">
                      <div class="footer__contact-element">
                        <i class="fa fa-mobile-phone"></i>
                        <p>096861xxxx</p>
                    </div>
                    <div class="footer__contact-element">
                      <i class="fa-regular fa-envelope"></i>
                      <p>
                        quoccaoxxx@gmail.com
                      </p>
                   </div>
                    </div>
                </div>
                <div class="footer__element col-md-3">
                 <p>THEO DÕI CHÚNG TÔI TRÊN</p>

                 <div class="footer__contact">
                  <div class="footer__contact-element">
                    <i class="fa-brands fa-square-facebook"></i>
                    <p>Facebook
                    </p>
                  </div>
                  <div class="footer__contact-element">
                    <i class="fa-brands fa-instagram"></i>
                    <p>
                      Instagram
                    </p>
                  </div>
                  <div class="footer__contact-element">
                    <i class="fa-brands fa-square-twitter"></i>
                    <p>
                      Twitter
                    </p>
                  </div>

                </div>
            </div>
        </div>
    </footer>
    <div class="modal">

    </div>
    <!-- footer -->
    <script src="../static/js/main.js"></script>
    <script th:inline="javascript">
   
      let handleClick = (id)=>
      {   
        document.location = '/product/'+id;
      }

      const  btn_high = document.querySelector('.btn_high')
      btn_high.onclick = ()=>
      {
        
        var productLists=/*[[${productList}]]*/
        productLists.sort((a,b)=>
        {
          return a.price - b.price
        })
     
        var htmls =  productLists.map(productList => {
          const price =getChangeMomneyFormat(productList.price)
          console.log(price)
        return `<div class="col-md-3 col-sm-6">
                    <div onclick="handleClick(${productList.id})" class="card" style="width: 100%;">
                      <img style="object-fit: scale-down;"height="200" src="data:image/jpeg;base64, ${productList.image}" class="card-img-top" alt="...">
                        <div class="card-body">
                          <h1 class="card-title">${productList.title}</h1>
                          <p class="card-sub">Đậm đà vị cafe</p>
                          <div class="card__price d-flex">
                            <p class="price">${price}</p>
                            <div class="card_status d-flex">
                              <p class="card_status_des">đã bán</p>
                              <p class="quantities">${productList.saled}</p>
                            </div>
                          </div>
                          
                        </div>
                      </div>
                </div>`
        }
        ).join('')

  document.querySelector('.row__products').innerHTML = htmls


       

     
  }

  const  btn_low = document.querySelector('.btn_low')
  btn_low.onclick = ()=>
      {
        
        var productLists=/*[[${productList}]]*/
        productLists.sort((a,b)=>
        {
          return b.price - a.price
        })
     
        var htmls =  productLists.map(productList => {
          const price =getChangeMomneyFormat(productList.price)
          console.log(price)
        return `<div class="col-md-3 col-sm-6">
                    <div onclick="handleClick(${productList.id})" class="card" style="width: 100%;">
                      <img style="object-fit: scale-down;"height="200" src="data:image/jpeg;base64, ${productList.image}" class="card-img-top" alt="...">
                        <div class="card-body">
                          <h1 class="card-title">${productList.title}</h1>
                          <p class="card-sub">Đậm đà vị cafe</p>
                          <div class="card__price d-flex">
                            <p class="price">${price}</p>
                            <div class="card_status d-flex">
                              <p class="card_status_des">đã bán</p>
                              <p class="quantities">${productList.saled}</p>
                            </div>
                          </div>
                          
                        </div>
                      </div>
                </div>`
        }
        ).join('')

  document.querySelector('.row__products').innerHTML = htmls


       

     
  }
  const btn_sale = document.querySelector('.btn_sale')


  btn_sale.onclick = ()=>
      {
        
        var productLists=/*[[${productList}]]*/
        productLists.sort((a,b)=>
        {
          return b.saled - a.saled
        })
     
        var htmls =  productLists.map(productList => {
          const price =getChangeMomneyFormat(productList.price)
          console.log(price)
        return `<div class="col-md-3 col-sm-6">
                    <div onclick="handleClick(${productList.id})" class="card" style="width: 100%;">
                      <img style="object-fit: scale-down;"height="200" src="data:image/jpeg;base64, ${productList.image}" class="card-img-top" alt="...">
                        <div class="card-body">
                          <h1 class="card-title">${productList.title}</h1>
                          <p class="card-sub">Đậm đà vị cafe</p>
                          <div class="card__price d-flex">
                            <p class="price">${price}</p>
                            <div class="card_status d-flex">
                              <p class="card_status_des">đã bán</p>
                              <p class="quantities">${productList.saled}</p>
                            </div>
                          </div>
                          
                        </div>
                      </div>
                </div>`
        }
        ).join('')

  document.querySelector('.row__products').innerHTML = htmls


       

     
  }
  


  function getChangeMomneyFormat(price){
	let number = ""+price
	const { format } = new Intl.NumberFormat('vi-VN');
	const [, decimalSign] = /^0(.)1$/.exec(format(0.1));
	var num = number.replace(new RegExp(`[^${decimalSign}\\d]`, 'g'), '').replace(decimalSign, '.');
	var numFloat=parseFloat(num);
    let number3=numFloat.toLocaleString('vi-VN');
    return number3
}
const price = document.querySelectorAll('.price')
    price.forEach((e)=>
    {
      var x = Number.parseInt(e.innerHTML);
      console.log(x)   
      e.innerHTML = getChangeMomneyFormat(x)
    })
    const logBut = document.querySelector('.navbar__user-dropdown')
    const navbar__user = document.querySelector('.navbar__user-dropdown_list')
    logBut.onclick = ()=>
    {
        navbar__user.classList.toggle('active')
    }
    // search
    const navbar__search = document.querySelector('.navbar__search input')
navbar__search.addEventListener('keypress',(e)=>
{
  const value = e.target.value.trim()


    if(e.keyCode===13||e.which===13)
  {
    if(value =='')
  {
    alert('Vui Lòng Nhập Từ Khóa Cần Tìm')
    return
  }
      document.location='/product/search/'+value
  
  }

 

})

    // search
    navbar__search.oninput = (e)=>
      {
      const modal = document.querySelector('.modal')

        const navbar__search_list = document.querySelector('.navbar__search-list')
        modal.classList.add('active')
        navbar__search_list.classList.add('active')

        const key = e.target.value
        
        fetch(`http://localhost:8888/search/${key}`)
        .then(res =>res.json())
        .then(datas=>{
          console.log(datas)
         var htmls= datas.data.map(data=>
          { return`
            <li onclick='handleSearchClick(${data.id})' class="navbar__search-item">${data.title}</li>
             `
          })
    
          // var htmls = datas.map((data)=>
          // {
          //   console.log(data.categoryName)
          //   // return`
          //   // <li class="navbar__search-item">${data.categoryName}</li>
          //   // `
          // })
          navbar__search_list.innerHTML = htmls.join('')
        })
      }
    const navbar__search_list = document.querySelector('.navbar__search-list')    
    const modal = document.querySelector('.modal')
    modal.onclick = ()=>
    {
      modal.classList.remove('active')
      navbar__search_list.innerHTML=''
      navbar__search_list.classList.remove('active')
      
    }
    navbar__search_list.onclick = (e)=>
    {
      e.stopPropagation()

    }
      // navbar__search.onblur = ()=>
      // {
      //   const navbar__search_list = document.querySelector('.navbar__search-list')
      //   navbar__search_list.classList.remove('active')
      // }
      //search
      const handleSearchClick = (id)=>
      {
        document.location = '/product/'+id;
      }
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <!-- JavaScript Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.1/jquery.min.js" integrity="sha512-aVKKRRi/Q/YV+4mjoKBsE4x3H+BkegoM/em46NNlCqNTmUYADjBbeNefNxYV7giUp0VxICtqdrbqU7iVaeZNXA==" crossorigin="anonymous" referrerpolicy="no-referrer"></>
      <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.min.js" integrity="sha384-7VPbUDkoPSGFnVtYi0QogXtr74QeVeeIs99Qfg5YCF+TidwNdjvaKZX19NZ/e6oz" crossorigin="anonymous"></script> -->
</body>
</html>